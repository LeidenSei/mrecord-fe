<div class="view-wrapper monthly-plan-page">

  <div class="month-info-header">
    <div class="month-title">
      <h3>K·∫æ HO·∫†CH TH√ÅNG TH·ª® {{selectedMonth}}</h3>
      <span class="date-range">
        (T·ª´ ng√†y {{startDate}}/{{monthPadded}}/{{selectedYear}} ƒë·∫øn {{endDate}}/{{monthPadded}}/{{selectedYear}})
      </span>
    </div>

    <div class="filter-toolbar">
      <div class="toolbar-group">
        <label>Kh·ªëi h·ªçc:</label>
        <dx-drop-down-button
          stylingMode="text"
          [useSelectMode]="true"
          [items]="gradeSource"
          (onItemClick)="gradeChange($event)"
          [selectedItemKey]="gradeSource[0]"
          [dropDownOptions]="{ width: 'auto' }"
        ></dx-drop-down-button>
      </div>
      
      <div class="toolbar-group">
        <label>L·ªõp h·ªçc:</label>
        <dx-drop-down-button
          stylingMode="text"
          [useSelectMode]="true"
          [items]="filterClassSource"
          keyExpr="id"
          displayExpr="name"
          (onItemClick)="classChange($event)"
          [selectedItemKey]="filterClassId"
          [dropDownOptions]="{ width: 'auto' }"
        ></dx-drop-down-button>
      </div>

      <div class="toolbar-group">
        <label>Th√°ng:</label>
        <dx-drop-down-button
          stylingMode="text"
          [useSelectMode]="true"
          [items]="monthSource"
          keyExpr="id"
          displayExpr="name"
          (onItemClick)="monthChange($event)"
          [selectedItemKey]="selectedMonth"
          [dropDownOptions]="{ width: 'auto' }"
        ></dx-drop-down-button>
      </div>

      <div class="toolbar-group">
        <label>NƒÉm:</label>
        <dx-drop-down-button
          stylingMode="text"
          [useSelectMode]="true"
          [items]="yearSource"
          keyExpr="id"
          displayExpr="name"
          (onItemClick)="yearChange($event)"
          [selectedItemKey]="selectedYear"
          [dropDownOptions]="{ width: 'auto' }"
        ></dx-drop-down-button>
      </div>
    </div>

    <div class="topic-focus-section">
      <div class="input-group">
        <label>Ch·ªß ƒë·ªÅ:</label>
        <input 
          type="text" 
          [(ngModel)]="monthlyTopic" 
          (ngModelChange)="onTopicChange()"
          class="topic-input" 
          placeholder="Nh·∫≠p ch·ªß ƒë·ªÅ th√°ng..." 
        />
      </div>
      <div class="input-group">
        <label>Tr·ªçng t√¢m:</label>
        <input 
          type="text" 
          [(ngModel)]="monthlyFocus" 
          (ngModelChange)="onFocusChange()"
          class="focus-input" 
          placeholder="Nh·∫≠p tr·ªçng t√¢m th√°ng..." 
        />
      </div>
    </div>
  </div>

  <as-split 
    direction="horizontal" 
    class="main-splitter"
    [gutterSize]="8"
    [restrictMove]="true"
    unit="percent"
    (dragEnd)="onSplitDragEnd($event)"
  >
    
    <as-split-area [size]="50" [minSize]="30" [maxSize]="70">
      <div class="section-container plan-section">
        <div class="section-header">
          <div class="header-content">
            <div class="section-icon">
              <i class="dx-icon-event"></i>
            </div>
            <div class="header-text">
              <h3>K·∫æ HO·∫†CH TH√ÅNG</h3>
              <div class="subtitle">L·∫≠p k·∫ø ho·∫°ch v√† theo d√µi ti·∫øn ƒë·ªô h√†ng th√°ng</div>
            </div>
          </div>
          <div class="stats-badge" *ngIf="planCount > 0">
            <i class="dx-icon-chart"></i>
            {{planCount}} k·∫ø ho·∫°ch
          </div>
        </div>

        <div class="grid-content">
          <dx-data-grid
            #planGrid
            class="grid theme-dependent"
            [rowAlternationEnabled]="true"
            noDataText=""
            columnResizingMode="widget"
            [dataSource]="monthlyPlanData"
            [allowColumnReordering]="true"
            [showBorders]="true"
            [showColumnLines]="true"
            [showRowLines]="true"
            [columnMinWidth]="50"
            [columnAutoWidth]="true"
            [columnResizingMode]="'nextColumn'"
            [allowColumnResizing]="true"
            (onExporting)="onPlanExporting($event)"
            (onRowUpdating)="onPlanRowUpdating($event)"
            (onRowInserting)="onPlanRowInserting($event)"
            (onRowRemoving)="onPlanRowRemoving($event)"
          >
            <dxo-scrolling mode="virtual" rowRenderingMode="virtual"></dxo-scrolling>
            <dxo-load-panel [showPane]="true" [enabled]="true"></dxo-load-panel>
            <dxo-sorting mode="multiple"></dxo-sorting>
            <dxo-header-filter [visible]="true"></dxo-header-filter>
            <dxo-column-chooser [enabled]="true"></dxo-column-chooser>
            <dxo-editing
              mode="popup"
              [allowUpdating]="true"
              [allowAdding]="true"
              [allowDeleting]="true"
              [useIcons]="true"
            >
              <dxo-texts
                saveRowChanges="üíæ L∆∞u"
                cancelRowChanges="‚ùå H·ªßy"
                confirmDeleteMessage="B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a?"
              ></dxo-texts>
              <dxo-popup
                title="üìã Th√¥ng tin k·∫ø ho·∫°ch th√°ng"
                [showTitle]="true"
                [width]="750"
                [height]="600"
                [wrapperAttr]="{ class: 'plan-popup-wrapper' }"
              ></dxo-popup>
              <dxo-form [labelLocation]="'top'">
                <dxi-item itemType="group" [colCount]="2" [colSpan]="2" caption="Th·ªùi gian th·ª±c hi·ªán">
                  <dxi-item dataField="timeFrom" [isRequired]="true">
                    <dxo-label text="üìÖ T·ª´ ng√†y"></dxo-label>
                  </dxi-item>
                  <dxi-item dataField="timeTo" [isRequired]="true">
                    <dxo-label text="üìÖ ƒê·∫øn ng√†y"></dxo-label>
                  </dxi-item>
                </dxi-item>
                <dxi-item itemType="group" [colCount]="1" [colSpan]="2" caption="N·ªôi dung chi ti·∫øt">
                  <dxi-item dataField="content" [isRequired]="true">
                    <dxo-label text="üìù N·ªôi dung k·∫ø ho·∫°ch"></dxo-label>
                  </dxi-item>
                  <dxi-item dataField="evaluation">
                    <dxo-label text="‚≠ê ƒê√°nh gi√° k·∫øt qu·∫£"></dxo-label>
                  </dxi-item>
                </dxi-item>
              </dxo-form>
            </dxo-editing>
            
            <dxo-export
              [enabled]="true"
              [texts]="exportTexts"
              showText="always"
              [allowExportSelectedData]="false"
              [formats]="['xlsx']"
            ></dxo-export>
            
            <dxo-toolbar>
              <dxi-item name="addRowButton"></dxi-item>
              <dxi-item name="exportButton"></dxi-item>
            </dxo-toolbar>

            <dxi-column
              fixedPosition="left" 
              dataField="stt" 
              alignment="center" 
              [allowFiltering]="false" 
              [width]="50" 
              caption="STT"
              [allowEditing]="false"
            ></dxi-column>
            
            <dxi-column 
              dataField="timeFrom" 
              [width]="100" 
              caption="T·ª´"
              alignment="center"
              dataType="date"
              format="dd/MM/yyyy"
              editorType="dxDateBox"
            >
              <dxo-form-item [editorOptions]="{ 
                displayFormat: 'dd/MM/yyyy',
                type: 'date',
                showClearButton: true,
                useMaskBehavior: true
              }"></dxo-form-item>
            </dxi-column>
            
            <dxi-column 
              dataField="timeTo" 
              [width]="100" 
              caption="ƒê·∫øn"
              alignment="center"
              dataType="date"
              format="dd/MM/yyyy"
              editorType="dxDateBox"
            >
              <dxo-form-item [editorOptions]="{ 
                displayFormat: 'dd/MM/yyyy',
                type: 'date',
                showClearButton: true,
                useMaskBehavior: true
              }"></dxo-form-item>
            </dxi-column>
            
            <dxi-column 
              dataField="content" 
              caption="N·ªôi dung"
              editorType="dxTextArea"
            >
              <dxo-form-item [editorOptions]="{ 
                height: 120,
                maxLength: 500
              }"></dxo-form-item>
            </dxi-column>
            
            <dxi-column 
              dataField="evaluation" 
              [width]="150" 
              caption="ƒê√°nh gi√° k·∫øt qu·∫£"
              editorType="dxTextArea"
            >
              <dxo-form-item [editorOptions]="{ 
                height: 100,
                maxLength: 300
              }"></dxo-form-item>
            </dxi-column>

            <dxi-column type="buttons" [width]="100" fixedPosition="right">
              <dxi-button name="edit"></dxi-button>
              <dxi-button name="delete"></dxi-button>
            </dxi-column>

          </dx-data-grid>
        </div>
      </div>
    </as-split-area>

    <as-split-area [size]="50" [minSize]="30" [maxSize]="70">
      <div class="section-container journal-section">
        <div class="section-header">
          <div class="header-content">
            <div class="section-icon">
              <i class="dx-icon-doc"></i>
            </div>
            <div class="header-text">
              <h3>NH·∫¨T K√ç CH·ª¶ NHI·ªÜM</h3>
              <div class="subtitle">Ghi ch√©p v√† theo d√µi ho·∫°t ƒë·ªông gi·∫£ng d·∫°y</div>
            </div>
          </div>
          <div class="stats-badge" *ngIf="journalCount > 0">
            <i class="dx-icon-bookmark"></i>
            {{journalCount}} ghi ch√©p
          </div>
        </div>

        <div class="grid-content">
          <dx-data-grid
            #journalGrid
            class="grid theme-dependent"
            [rowAlternationEnabled]="true"
            noDataText=""
            columnResizingMode="widget"
            [dataSource]="teacherJournalData"
            [allowColumnReordering]="true"
            [showBorders]="true"
            [showColumnLines]="true"
            [showRowLines]="true"
            [columnMinWidth]="50"
            [columnAutoWidth]="true"
            [columnResizingMode]="'nextColumn'"
            [allowColumnResizing]="true"
            (onExporting)="onJournalExporting($event)"
            (onRowUpdating)="onJournalRowUpdating($event)"
            (onRowInserting)="onJournalRowInserting($event)"
            (onRowRemoving)="onJournalRowRemoving($event)"
          >
            <dxo-scrolling mode="virtual" rowRenderingMode="virtual"></dxo-scrolling>
            <dxo-load-panel [showPane]="true" [enabled]="true"></dxo-load-panel>
            <dxo-sorting mode="multiple"></dxo-sorting>
            <dxo-header-filter [visible]="true"></dxo-header-filter>
            <dxo-column-chooser [enabled]="true"></dxo-column-chooser>
            <dxo-editing
              mode="popup"
              [allowUpdating]="true"
              [allowAdding]="true"
              [allowDeleting]="true"
              [useIcons]="true"
            >
              <dxo-texts
              saveRowChanges="üíæ L∆∞u"
              cancelRowChanges="‚ùå H·ªßy"
              confirmDeleteMessage="B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a?"
            ></dxo-texts>
              <dxo-popup
                title="üìñ Nh·∫≠t k√Ω ch·ªß nhi·ªám"
                [showTitle]="true"
                [width]="700"
                [height]="500"
                [wrapperAttr]="{ class: 'journal-popup-wrapper' }"
              ></dxo-popup>
              <dxo-form [labelLocation]="'top'">
                <dxi-item itemType="group" [colCount]="1" [colSpan]="2">
                  <dxi-item dataField="date" [isRequired]="true">
                    <dxo-label text="üìÖ Ng√†y ghi ch√©p"></dxo-label>
                  </dxi-item>
                  <dxi-item dataField="content" [isRequired]="true">
                    <dxo-label text="‚úçÔ∏è N·ªôi dung nh·∫≠t k√Ω"></dxo-label>
                  </dxi-item>
                </dxi-item>
              </dxo-form>
            </dxo-editing>
                        
            <dxo-export
              [enabled]="true"
              [texts]="exportTexts"
              showText="always"
              [allowExportSelectedData]="false"
              [formats]="['xlsx']"
            ></dxo-export>
            
            <dxo-toolbar>
              <dxi-item name="addRowButton"></dxi-item>
              <dxi-item name="exportButton"></dxi-item>
            </dxo-toolbar>

            <dxi-column
              fixedPosition="left" 
              dataField="stt" 
              alignment="center" 
              [allowFiltering]="false" 
              [width]="50" 
              caption="STT"
              [allowEditing]="false"
            ></dxi-column>
            
            <dxi-column 
              dataField="date" 
              dataType="date"
              [width]="120" 
              caption="Th·ªùi gian"
              format="dd/MM/yyyy"
              editorType="dxDateBox"
            >
              <dxo-form-item [editorOptions]="{ 
                displayFormat: 'dd/MM/yyyy',
                type: 'date',
                showClearButton: true,
                useMaskBehavior: true
              }"></dxo-form-item>
            </dxi-column>
            
            <dxi-column 
              dataField="content" 
              caption="N·ªôi dung nh·∫≠t k√≠ c·ªßa ng∆∞·ªùi th·∫ßy"
              editorType="dxTextArea"
            >
              <dxo-form-item [editorOptions]="{ 
                height: 150,
                maxLength: 500
              }"></dxo-form-item>
            </dxi-column>

            <dxi-column type="buttons" [width]="100" fixedPosition="right">
              <dxi-button name="edit"></dxi-button>
              <dxi-button name="delete"></dxi-button>
            </dxi-column>

          </dx-data-grid>
        </div>
      </div>
    </as-split-area>

  </as-split>

</div>