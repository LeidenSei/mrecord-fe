<div class="view-wrapper monthly-plan-page">
  
  <!-- HEADER FILTER ƒê∆†N GI·∫¢N -->
  <div class="card border-0 shadow-sm mb-3">
    <div class="card-body">
      <!-- Title -->
      <div class="d-flex justify-content-between align-items-center mb-3 pb-3 border-bottom">
        <div class="d-flex align-items-center gap-3">
          <i class="dx-icon-event text-primary" style="font-size: 24px;"></i>
          <div>
            <h4 class="mb-1 fw-semibold">K·∫ø ho·∫°ch th√°ng {{selectedMonth}}</h4>
            <small class="text-muted">
              {{startDate}}/{{monthPadded}}/{{selectedYear}} - {{endDate}}/{{monthPadded}}/{{selectedYear}}
            </small>
          </div>
        </div>
        <span class="badge bg-primary rounded-pill" *ngIf="planCount > 0">
          {{planCount}} k·∫ø ho·∫°ch
        </span>
      </div>

      <!-- Filters -->
      <div class="d-flex gap-3 align-items-center flex-wrap">
        <div class="d-flex align-items-center gap-2">
          <label class="mb-0 small fw-medium">Kh·ªëi h·ªçc:</label>
          <dx-drop-down-button
            stylingMode="outlined"
            [useSelectMode]="true"
            [items]="gradeSource"
            (onItemClick)="gradeChange($event)"
            [selectedItemKey]="gradeSource[0]"
            [width]="120">
          </dx-drop-down-button>
        </div>
        
        <div class="d-flex align-items-center gap-2">
          <label class="mb-0 small fw-medium">L·ªõp h·ªçc:</label>
          <dx-drop-down-button
            stylingMode="outlined"
            [useSelectMode]="true"
            [items]="filterClassSource"
            keyExpr="id"
            displayExpr="name"
            (onItemClick)="classChange($event)"
            [selectedItemKey]="filterClassId"
            [width]="150">
          </dx-drop-down-button>
        </div>

        <div class="d-flex align-items-center gap-2">
          <label class="mb-0 small fw-medium">Th√°ng:</label>
          <dx-drop-down-button
            stylingMode="outlined"
            [useSelectMode]="true"
            [items]="monthSource"
            keyExpr="id"
            displayExpr="name"
            (onItemClick)="monthChange($event)"
            [selectedItemKey]="selectedMonth"
            [width]="120">
          </dx-drop-down-button>
        </div>

        <div class="d-flex align-items-center gap-2">
          <label class="mb-0 small fw-medium">NƒÉm:</label>
          <dx-drop-down-button
            stylingMode="outlined"
            [useSelectMode]="true"
            [items]="yearSource"
            keyExpr="id"
            displayExpr="name"
            (onItemClick)="yearChange($event)"
            [selectedItemKey]="selectedYear"
            [width]="100">
          </dx-drop-down-button>
        </div>
      </div>

      <div class="row g-3 mt-2">
        <div class="col-md-6">
          <label class="form-label small fw-medium text-primary">Ch·ªß ƒë·ªÅ:</label>
          <input type="text" class="form-control form-control-sm" 
                [(ngModel)]="monthlyTopic" 
                (ngModelChange)="onTopicChange()"
                placeholder="Nh·∫≠p ch·ªß ƒë·ªÅ th√°ng..." />
        </div>
        <div class="col-md-6">
          <label class="form-label small fw-medium text-primary">Tr·ªçng t√¢m:</label>
          <input type="text" class="form-control form-control-sm" 
                [(ngModel)]="monthlyFocus" 
                (ngModelChange)="onFocusChange()"
                placeholder="Nh·∫≠p tr·ªçng t√¢m th√°ng..." />
        </div>
      </div>
    </div>
  </div>

  <!-- SPLIT PANELS GI·ªÆ NGUY√äN -->
  <as-split direction="horizontal" class="main-splitter" [gutterSize]="8" unit="percent">
    
    <!-- LEFT PANEL - K·∫æ HO·∫†CH -->
    <as-split-area [size]="50" [minSize]="30" [maxSize]="70">
      <div class="card border-0 shadow-sm h-100 d-flex flex-column">
        <!-- Header -->
        <div class="card-header bg-primary bg-gradient text-white">
          <div class="d-flex justify-content-between align-items-center">
            <div class="d-flex align-items-center gap-2">
              <i class="dx-icon-event" style="font-size: 20px;"></i>
              <div>
                <h5 class="mb-0 fw-semibold">K·∫ø ho·∫°ch th√°ng</h5>
                <small class="opacity-75" style="font-size: 12px;">L·∫≠p k·∫ø ho·∫°ch v√† theo d√µi ti·∫øn ƒë·ªô</small>
              </div>
            </div>
            <span class="badge bg-white text-primary" *ngIf="planCount > 0">
              {{planCount}}
            </span>
          </div>
        </div>

        <!-- Grid Content -->
        <div class="card-body p-3 flex-grow-1 overflow-hidden">
          <dx-data-grid
            #planGrid
            class="h-100"
            [dataSource]="monthlyPlanData"
            [showBorders]="true"
            [rowAlternationEnabled]="true"
            [columnAutoWidth]="true"
            (onExporting)="onPlanExporting($event)"
            (onRowUpdating)="onPlanRowUpdating($event)"
            (onRowInserting)="onPlanRowInserting($event)"
            (onRowRemoving)="onPlanRowRemoving($event)">
            
            <dxo-scrolling mode="virtual"></dxo-scrolling>
            <dxo-editing mode="popup" [allowUpdating]="true" [allowAdding]="true" [allowDeleting]="true">
              <dxo-popup title="üìã K·∫ø ho·∫°ch th√°ng" [width]="700" [height]="500"></dxo-popup>
              <dxo-form [labelLocation]="'top'">
                <dxi-item itemType="group" [colCount]="2">
                  <dxi-item dataField="timeFrom" [isRequired]="true">
                    <dxo-label text="T·ª´ ng√†y"></dxo-label>
                  </dxi-item>
                  <dxi-item dataField="timeTo" [isRequired]="true">
                    <dxo-label text="ƒê·∫øn ng√†y"></dxo-label>
                  </dxi-item>
                </dxi-item>
                <dxi-item dataField="content" [isRequired]="true">
                  <dxo-label text="N·ªôi dung"></dxo-label>
                </dxi-item>
                <dxi-item dataField="evaluation">
                  <dxo-label text="ƒê√°nh gi√°"></dxo-label>
                </dxi-item>
              </dxo-form>
            </dxo-editing>
            
            <dxo-toolbar>
              <dxi-item name="addRowButton"></dxi-item>
              <dxi-item name="exportButton"></dxi-item>
            </dxo-toolbar>

            <dxi-column dataField="stt" caption="STT" [width]="60" alignment="center" [allowEditing]="false"></dxi-column>
            <dxi-column dataField="timeFrom" caption="T·ª´" dataType="date" format="dd/MM/yyyy" [width]="100"></dxi-column>
            <dxi-column dataField="timeTo" caption="ƒê·∫øn" dataType="date" format="dd/MM/yyyy" [width]="100"></dxi-column>
            <dxi-column dataField="content" caption="N·ªôi dung"></dxi-column>
            <dxi-column dataField="evaluation" caption="ƒê√°nh gi√°" [width]="150"></dxi-column>
            <dxi-column type="buttons" [width]="100">
              <dxi-button name="edit"></dxi-button>
              <dxi-button name="delete"></dxi-button>
            </dxi-column>
          </dx-data-grid>
        </div>
      </div>
    </as-split-area>

    <!-- RIGHT PANEL - NH·∫¨T K√ù -->
    <as-split-area [size]="50" [minSize]="30" [maxSize]="70">
      <div class="card border-0 shadow-sm h-100 d-flex flex-column">
        <!-- Header -->
        <div class="card-header bg-danger bg-gradient text-white">
          <div class="d-flex justify-content-between align-items-center">
            <div class="d-flex align-items-center gap-2">
              <i class="dx-icon-doc" style="font-size: 20px;"></i>
              <div>
                <h5 class="mb-0 fw-semibold">Nh·∫≠t k√Ω ch·ªß nhi·ªám</h5>
                <small class="opacity-75" style="font-size: 12px;">Ghi ch√©p ho·∫°t ƒë·ªông gi·∫£ng d·∫°y</small>
              </div>
            </div>
            <span class="badge bg-white text-danger" *ngIf="journalCount > 0">
              {{journalCount}}
            </span>
          </div>
        </div>

        <!-- Grid Content -->
        <div class="card-body p-3 flex-grow-1 overflow-hidden">
          <dx-data-grid
            #journalGrid
            class="h-100"
            [dataSource]="teacherJournalData"
            [showBorders]="true"
            [rowAlternationEnabled]="true"
            [columnAutoWidth]="true"
            (onExporting)="onJournalExporting($event)"
            (onRowUpdating)="onJournalRowUpdating($event)"
            (onRowInserting)="onJournalRowInserting($event)"
            (onRowRemoving)="onJournalRowRemoving($event)">
            
            <dxo-scrolling mode="virtual"></dxo-scrolling>
            <dxo-editing mode="popup" [allowUpdating]="true" [allowAdding]="true" [allowDeleting]="true">
              <dxo-popup title="üìñ Nh·∫≠t k√Ω ch·ªß nhi·ªám" [width]="700" [height]="400"></dxo-popup>
              <dxo-form [labelLocation]="'top'">
                <dxi-item dataField="date" [isRequired]="true">
                  <dxo-label text="Ng√†y"></dxo-label>
                </dxi-item>
                <dxi-item dataField="content" [isRequired]="true">
                  <dxo-label text="N·ªôi dung"></dxo-label>
                </dxi-item>
              </dxo-form>
            </dxo-editing>
            
            <dxo-toolbar>
              <dxi-item name="addRowButton"></dxi-item>
              <dxi-item name="exportButton"></dxi-item>
            </dxo-toolbar>

            <dxi-column dataField="stt" caption="STT" [width]="60" alignment="center" [allowEditing]="false"></dxi-column>
            <dxi-column dataField="date" caption="Th·ªùi gian" dataType="date" format="dd/MM/yyyy" [width]="120"></dxi-column>
            <dxi-column dataField="content" caption="N·ªôi dung nh·∫≠t k√≠"></dxi-column>
            <dxi-column type="buttons" [width]="100">
              <dxi-button name="edit"></dxi-button>
              <dxi-button name="delete"></dxi-button>
            </dxi-column>
          </dx-data-grid>
        </div>
      </div>
    </as-split-area>

  </as-split>
</div>