<div class="view-wrapper student-tracking-page">
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-2 student-list-panel">
        <div class="panel-header">
          <h5>
            <i class="fa fa-users me-2"></i>
            Học sinh
          </h5>
        </div>
       
        <div class="filter-section">
          <label class="form-label">Lớp</label>
          <dx-drop-down-button
            stylingMode="outlined"
            [useSelectMode]="true"
            [items]="filterClassSource"
            keyExpr="id"
            displayExpr="name"
            (onItemClick)="classChange($event)"
            [selectedItemKey]="filterClassId"
            [dropDownOptions]="{ width: '100%' }"
            class="w-100"
          ></dx-drop-down-button>
        </div>
       
        <div class="student-list">
          <div
            *ngFor="let student of studentList"
            class="student-item"
            [class.active]="selectedStudent?.id === student.id"
            (click)="selectStudent(student)"
          >
            <div class="student-info">
              <div class="student-name">{{ student.fullName }}</div>
              <div class="student-code text-muted">{{ student.code }}</div>
            </div>
          </div>
         
          <div *ngIf="studentList.length === 0" class="text-center text-muted p-3">
            <small>Không có học sinh</small>
          </div>
        </div>
      </div>
     
      <div class="col-md-10 tracking-panel">
        <div class="panel-header d-flex justify-content-between align-items-center">
          <div class="d-flex align-items-center gap-2">
            <i class="fa fa-file-text-o"></i>
            <h5>Theo dõi quan tâm học sinh</h5>
            <span *ngIf="trackingCount > 0" class="badge bg-secondary">{{trackingCount}}</span>
          </div>
         
          <div class="d-flex align-items-center gap-3">
            <div class="d-flex align-items-center gap-2">
              <label>Mốc thời gian:</label>
              <dx-drop-down-button
                stylingMode="text"
                [useSelectMode]="true"
                [items]="periodSource"
                keyExpr="value"
                displayExpr="name"
                (onItemClick)="periodChange($event)"
                [selectedItemKey]="selectedPeriod"
              ></dx-drop-down-button>
            </div>
           
            <button class="btn btn-success btn-sm" (click)="addNewRow()" [disabled]="!selectedStudent">
              <i class="fa fa-plus me-1"></i> Thêm mới
            </button>
           
            <button class="btn btn-primary btn-sm" (click)="exportToExcel()">
              <i class="fa fa-file-excel-o me-1"></i> Xuất Excel
            </button>
          </div>
        </div>
       
        <div class="selected-student-info" *ngIf="selectedStudent">
          <strong>Học sinh:</strong> {{ selectedStudent.fullName }}
        </div>
       
        <div class="grid-container">
          <ag-grid-angular
            class="ag-theme-alpine"
            [rowData]="rowData"
            [columnDefs]="columnDefs"
            [defaultColDef]="defaultColDef"
            [gridOptions]="gridOptions"
            [animateRows]="true"
            (gridReady)="onGridReady($event)"
            (cellValueChanged)="onCellValueChanged($event)"
            (cellClicked)="onCellClicked($event)"
            style="width: 100%; height: 100%;"
          >
          </ag-grid-angular>
        </div>
      </div>
    </div>
  </div>
</div>