<div class="form-container-no-flex">
  <div class="alert alert-info text-center">
    Tổng số lần thi: <strong>{{studentResults.length}}</strong> Điểm cao nhất: <strong>{{getMaxMarkResult() | round}}</strong>
  </div>
  <dx-data-grid
    noDataText=""
    id="gridResult"
    width="100%"
    [dataSource]="studentResults"
    keyExpr="id"
    [showBorders]="true"
  >
    <dxi-column dataField="stt" caption="Lần" [width]="65"></dxi-column>
    <dxi-column dataField="startTime" dataType="date" format="HH:mm dd/MM/yyyy"
                caption="Thời gian bắt đầu"></dxi-column>
    <dxi-column dataField="endTime" dataType="date" format="HH:mm dd/MM/yyyy"
                caption="Thời gian kết thúc"></dxi-column>
    <dxi-column dataField="totalMark" dataType="number" [format]="{ type: 'fixedPoint', precision: 2 }" caption="Điểm" [width]="80"></dxi-column>

    <dxi-column dataField="actionMinutes" caption="Thời gian làm bài" [width]="160"></dxi-column>
    <dxi-column cellTemplate="cellButtons" caption="" [width]="100"></dxi-column>
    <div *dxTemplate="let cellInfo of 'cellTotalMark'">
      {{cellInfo}}
    </div>
    <div *dxTemplate="let cellInfo of 'cellButtons'">
      <!--<a style="cursor: pointer" (click)="showResultDetail(cellInfo.data)">Chi tiết</a>-->
      <a *ngIf="!examPaper.isAuto" style="cursor: pointer" (click)="showResultDetail(cellInfo.data)">Chi tiết</a>
      <a *ngIf="examPaper.isAuto" style="cursor: pointer" (click)="showResultAutoDetail(cellInfo.data)">Chi tiết</a>
    </div>
    <dxo-load-panel [enabled]="true"></dxo-load-panel>
    <dxo-scrolling mode="virtual"></dxo-scrolling>
    <dxo-sorting mode="none"></dxo-sorting>
  </dx-data-grid>
</div>

<dx-popup
  [title]="resultDetailTitle"
  [(visible)]="isShowResultAutoDetail"
  [showCloseButton]="true"
  class="form-popup"
  [width]="isMobile ? '100%' : '600px'"
  [height]="isMobile ? '100%' : '600px'"
>
  <dxi-toolbar-item toolbar="bottom" location="after">
    <div class="form-popup-buttons-container">
      <dx-button
        text="Đóng"
        stylingMode="outlined"
        type="normal"
        (onClick)="isShowResultAutoDetail = false"
      ></dx-button>
    </div>
  </dxi-toolbar-item>
  <div class="form-container-no-flex">
    <div class="alert alert-info text-center">
      Số điểm: <strong>{{currentResult.totalMark | round}}</strong> Số câu đúng: <strong>{{currentResult.rightCount}}</strong>
    </div>
    <div *ngFor="let question of currentResult.studentAnswers2; let index = index" class="question-container">
      <div class="question-text">
        <strong>Câu {{index + 1}}.</strong><span [innerHTML]="question.htmlText"></span>
      </div>
      <ul class="answer-list">
        <li *ngFor="let answer of question.answers; let i = index"
            [ngClass]="{
          'correct-answer': answer.isCorrect,
          'wrong-answer': !answer.isCorrect && i === question.choosenIndex,
          'selected-answer': i === question.choosenIndex
        }">
          <div>
            <strong>{{alphabetArray[i]}}. </strong><span [innerHTML]="answer.htmlText"></span>
          </div>
        </li>
      </ul>
    </div>
  </div>
</dx-popup>

<dx-popup
  [title]="resultDetailTitle"
  [(visible)]="isShowResultDetail"
  [showCloseButton]="true"
  class="form-popup"
  [width]="isMobile ? '100%' : '500px'"
  [height]="isMobile ? '100%' : '500px'"
>
  <dxi-toolbar-item toolbar="bottom" location="after">
    <div class="form-popup-buttons-container">
      <dx-button
        text="Đóng"
        stylingMode="outlined"
        type="normal"
        (onClick)="closePopupViewResultDetail()"
      ></dx-button>
    </div>
  </dxi-toolbar-item>
  <div class="form-container-no-flex">
    <div class="alert alert-info text-center">
      Số điểm: <strong>{{currentResult.totalMark | round}}</strong> Số câu đúng: <strong>{{currentResult.rightCount}}</strong>
    </div>
    <table class="table table-bordered">
      <thead>
      <tr>
        <th class="text-center">STT</th>
        <th class="text-center">Đáp án</th>
        <th class="text-center">Lựa chọn của HS</th>
        <th width="50px"></th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let item of questionWithRightAnswers;let stt = index" class="answer-item">
        <td class="text-center">
          {{stt + 1}}
        </td>
        <td class="text-center">
          <div class="d-flex gap-2 justify-content-center">
            <dx-check-box [disabled]="true" *ngFor="let an of item.answers"
                          [(value)]="an.checked"
                          [text]="an.name"></dx-check-box>
          </div>
        </td>
        <td class="text-center">
          <span class="score score {{item.isCorrect}}">{{item.myAnswer}}</span>
        </td>
        <td class="text-center">
          <span *ngIf="item.isCorrect" class="dx-icon-check" style="font-size: 20px;color: #28a745"></span>
          <span *ngIf="!item.isCorrect" class="dx-icon-remove" style="font-size: 20px;color: red"></span>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
</dx-popup>
